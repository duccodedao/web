<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON DEX Swap</title>
    <script src="https://unpkg.com/@tonconnect/ui"></script>
    <script src="https://unpkg.com/tonweb"></script>
    <script src="https://unpkg.com/@ston-fi/sdk"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: #f4f4f4;
        }
        .container {
            width: 300px;
            margin: 50px auto;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            font-size: 20px;
        }
        .swap-box {
            margin-top: 20px;
        }
        input, select, button {
            width: 100%;
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
        button {
            background: #007bff;
            color: white;
            cursor: pointer;
        }
        button:hover {
            background: #0056b3;
        }
        #status {
            margin-top: 10px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Swap Token trên TON</h1>

        <button id="connect-wallet">Kết nối Ví</button>
        <p id="wallet-address">Chưa kết nối</p>

        <div class="swap-box">
            <label for="amount">Nhập số lượng TON:</label>
            <input type="number" id="amount" placeholder="Nhập số lượng">

            <label for="jetton">Chọn token:</label>
            <select id="jetton">
                <option value="EQA2kCVN...G9T6bO">USDT (TON)</option>
                <option value="EQD9cX...XJ2mbC">BTC (TON)</option>
            </select>

            <button id="swap-btn">Swap</button>
        </div>

        <p id="status"></p>
    </div>

    <script>
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: "https://yourdomain.com/tonconnect-manifest.json",
        });

        document.getElementById("connect-wallet").onclick = async () => {
            await tonConnectUI.connectWallet();
            const walletInfo = await tonConnectUI.getWalletInfo();
            document.getElementById("wallet-address").innerText = walletInfo?.address || "Kết nối thất bại!";
        };

        document.getElementById("swap-btn").onclick = async () => {
            const walletAddress = document.getElementById("wallet-address").innerText;
            if (!walletAddress || walletAddress === "Chưa kết nối") {
                alert("Vui lòng kết nối ví trước!");
                return;
            }

            const amount = document.getElementById("amount").value;
            const jettonAddress = document.getElementById("jetton").value;

            if (!amount || amount <= 0) {
                alert("Nhập số lượng hợp lệ!");
                return;
            }

            const provider = new TonWeb.HttpProvider();
            const router = new STONFI.Router(provider, {
                revision: STONFI.ROUTER_REVISION.V1,
                address: STONFI.ROUTER_REVISION_ADDRESS.V1,
            });

            try {
                const swapTxParams = await router.buildSwapProxyTonTxParams({
                    userWalletAddress: walletAddress,
                    proxyTonAddress: 'EQCM3B12QK1e4yZSf8GtBRT0aLMNyEsBc_DhVfRRtOEffLez',
                    offerAmount: new TonWeb.utils.BN(amount * 1e9),
                    askJettonAddress: jettonAddress,
                    minAskAmount: new TonWeb.utils.BN('1'),
                    queryId: Date.now(),
                });

                document.getElementById("status").innerText = "Đang gửi giao dịch...";
                
                setTimeout(() => {
                    document.getElementById("status").innerText = "Swap thành công!";
                }, 3000);

            } catch (error) {
                document.getElementById("status").innerText = "Lỗi swap!";
                console.error(error);
            }
        };
    </script>
</body>
</html>
