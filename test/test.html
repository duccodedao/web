<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>V√≠ TON</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            text-align: center;
            padding: 20px;
        }

        #ton-connect {
            margin-bottom: 20px;
        }

        #wallet-info {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            display: inline-block;
            text-align: left;
        }

        p {
            font-size: 16px;
            margin: 10px 0;
        }

        #wallet-balance {
            font-weight: bold;
            color: #007bff;
        }

        #wallet-usdt-value {
            font-weight: bold;
            color: #28a745;
        }

        #token-balance {
            font-weight: bold;
            color: #ff5722;
        }
    </style>
</head>
<body>

    <!-- N√∫t k·∫øt n·ªëi v√≠ -->
    <div id="ton-connect"></div>

    <!-- Hi·ªÉn th·ªã th√¥ng tin v√≠ -->
    <div id="wallet-info" style="display: none;">
        <p>üìå <strong>ƒê·ªãa ch·ªâ v√≠:</strong> <span id="wallet-address"></span></p>
        <p>üí∞ <strong>S·ªë d∆∞:</strong> <span id="wallet-balance"></span></p>
        <p>üíµ <strong>Gi√° tr·ªã t∆∞∆°ng ƒë∆∞∆°ng:</strong> <span id="wallet-usdt-value"></span></p>
        <p>üéØ <strong>Token BMC:</strong> <span id="token-balance"></span></p>
    </div>

    <script>
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://bmasshd.click/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });

        async function fetchWalletData(wallet) {
            if (!wallet) return;

            const walletAddress = wallet.account.address.toString();
            document.getElementById('wallet-address').textContent = walletAddress;
            document.getElementById('wallet-info').style.display = "block";

            try {
                // ‚úÖ L·∫•y s·ªë d∆∞ TON t·ª´ TonAPI
                const tonResponse = await fetch(`https://tonapi.io/v2/accounts/${walletAddress}`);
                const tonData = await tonResponse.json();
                const tonBalance = (tonData.balance / 1e9).toFixed(9); // Chuy·ªÉn sang TON
                document.getElementById('wallet-balance').textContent = `${tonBalance} TON`;

                // ‚úÖ L·∫•y gi√° TON/USDT t·ª´ CoinGecko
                const priceResponse = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=the-open-network&vs_currencies=usd');
                const priceData = await priceResponse.json();
                const tonPrice = priceData['the-open-network'].usd;

                // ‚úÖ Hi·ªÉn th·ªã gi√° tr·ªã USDT c·ªßa s·ªë d∆∞ TON
                const usdtValue = (tonBalance * tonPrice).toFixed(2);
                document.getElementById('wallet-usdt-value').textContent = `‚âà ${usdtValue} USDT`;

                // ‚úÖ L·∫•y danh s√°ch token trong v√≠
                const tokenResponse = await fetch(`https://tonapi.io/v2/accounts/${walletAddress}/tokens`);
                const tokenData = await tokenResponse.json();

                // ‚úÖ Ki·ªÉm tra token BMC
                const tokenBMC = tokenData.balances.find(token => token.jetton_address === 'EQCvxJy4eG8hyHBFsZ7eePxrRsUQSFE_jpptRAYBmcG_DOGS');
                if (tokenBMC) {
                    document.getElementById('token-balance').textContent = `${(tokenBMC.balance / 1e9).toFixed(2)} BMC`;
                } else {
                    document.getElementById('token-balance').textContent = "0 BMC";
                }

            } catch (error) {
                console.error("L·ªói khi l·∫•y d·ªØ li·ªáu:", error);
            }
        }

        // L·∫Øng nghe s·ª± ki·ªán k·∫øt n·ªëi
        tonConnectUI.onStatusChange(async (wallet) => {
            if (wallet) {
                fetchWalletData(wallet);
            }
        });
    </script>

</body>
</html>
