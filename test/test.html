<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Scan - Phiên bản đơn giản</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@tonconnect/sdk@latest"></script>
    <style>
        body { background-color: #f8f9fa; font-family: Arial, sans-serif; }
        .container { max-width: 800px; margin-top: 20px; }
        .card { margin-top: 10px; border-radius: 10px; }
        .btn { border-radius: 5px; }
        .list-group-item { font-size: 14px; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center text-primary">TON Scan - Phiên bản đơn giản</h2>
        
        <!-- Tìm kiếm -->
        <input type="text" id="searchInput" class="form-control" placeholder="Nhập địa chỉ ví / giao dịch / token">
        <button class="btn btn-primary mt-2 w-100" onclick="searchTON()">Tìm kiếm</button>
        
        <!-- Hiển thị số dư -->
        <div class="card mt-3">
            <div class="card-body">
                <h5 class="card-title text-success">Số dư ví</h5>
                <p id="balance">0 TON</p>
            </div>
        </div>

        <!-- Lịch sử giao dịch -->
        <div class="card mt-3">
            <div class="card-body">
                <h5 class="card-title text-info">Lịch sử giao dịch</h5>
                <ul id="transactionList" class="list-group"></ul>
            </div>
        </div>

        <!-- Thông tin Token -->
        <div class="card mt-3">
            <div class="card-body">
                <h5 class="card-title text-warning">Thông tin Token</h5>
                <p id="tokenInfo">Chưa có dữ liệu.</p>
            </div>
        </div>

        <!-- Kết nối ví TON -->
        <button class="btn btn-success mt-3 w-100" id="connectWallet">Kết nối ví TON</button>
    </div>

    <script>
        const API_BASE_URL = "https://tonapi.io/v1"; // API của TON

        // Kết nối TON Connect
        const tonConnect = new TON_CONNECT.TonConnect();
        document.getElementById("connectWallet").addEventListener("click", async () => {
            const wallets = await tonConnect.getWallets();
            if (wallets.length > 0) {
                await tonConnect.connect(wallets[0]);
                alert("Kết nối thành công!");
            } else {
                alert("Không tìm thấy ví TON nào.");
            }
        });

        // Tìm kiếm thông tin
        async function searchTON() {
            const query = document.getElementById("searchInput").value.trim();
            if (!query) {
                alert("Vui lòng nhập địa chỉ ví, giao dịch hoặc token.");
                return;
            }

            if (query.startsWith("EQ") || query.startsWith("UQ")) {
                fetchWalletData(query);
            } else if (query.length === 64) {
                fetchTransactionData(query);
            } else {
                fetchTokenData(query);
            }
        }

        // Lấy thông tin ví
        async function fetchWalletData(address) {
            try {
                const res = await fetch(`${API_BASE_URL}/accounts/${address}`);
                const data = await res.json();
                document.getElementById("balance").innerText = `${data.balance / 1e9} TON`;
                fetchTransactionHistory(address);
            } catch (error) {
                alert("Lỗi khi lấy thông tin ví.");
            }
        }

        // Lấy lịch sử giao dịch
        async function fetchTransactionHistory(address) {
            try {
                const res = await fetch(`${API_BASE_URL}/accounts/${address}/transactions`);
                const data = await res.json();
                const transactionList = document.getElementById("transactionList");
                transactionList.innerHTML = "";

                data.forEach(tx => {
                    const li = document.createElement("li");
                    li.classList.add("list-group-item");
                    li.innerHTML = `<strong>${tx.hash.substring(0, 10)}...</strong> - ${tx.value / 1e9} TON`;
                    transactionList.appendChild(li);
                });
            } catch (error) {
                alert("Lỗi khi lấy lịch sử giao dịch.");
            }
        }

        // Lấy thông tin giao dịch
        async function fetchTransactionData(txHash) {
            try {
                const res = await fetch(`${API_BASE_URL}/transactions/${txHash}`);
                const data = await res.json();
                alert(`Giao dịch ${txHash}: ${data.value / 1e9} TON`);
            } catch (error) {
                alert("Lỗi khi lấy thông tin giao dịch.");
            }
        }

        // Lấy thông tin Token
        async function fetchTokenData(tokenName) {
            try {
                const res = await fetch(`${API_BASE_URL}/tokens`);
                const data = await res.json();
                const token = data.find(t => t.symbol.toLowerCase() === tokenName.toLowerCase());

                if (token) {
                    document.getElementById("tokenInfo").innerText = `
                        Token: ${token.symbol}
                        Tổng cung: ${token.total_supply / 1e9} ${token.symbol}
                        Giá: ${token.price_usd} USD
                    `;
                } else {
                    alert("Không tìm thấy token.");
                }
            } catch (error) {
                alert("Lỗi khi lấy thông tin token.");
            }
        }
    </script>
</body>
</html>
