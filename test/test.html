<!DOCTYPE html>
<html>
<head>
    <title>Ton Connect Example</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tonweb@0.0.58/dist/tonweb.min.js"></script>
</head>
<body>
    <button id="connectButton">Connect Wallet</button>
    <div id="userInfo" style="display: none;">
        <p>Wallet Address: <span id="walletAddress"></span></p>
        <p>TON Balance: <span id="tonBalance"></span></p>
        <p>BMHD Balance: <span id="bmhdBalance"></span></p>
        <input type="number" id="tonAmount" placeholder="TON Amount">
        <button id="sendTonButton">Send TON</button>
        <button id="getBmhdButton">Get BMHD</button>
    </div>

    <script>
        const tonConnectUi = new window.TonConnectUI.create();
        const tonweb = new TonWeb(new TonWeb.HttpProvider('https://toncenter.com/api/v2/jsonRPC')); // Thay thế bằng API phù hợp
        const myAddress = 'UQDu8vyZSZbAYvRRQ_jW4_0EiBGibAGq72wSZjYWRmNAGhRD'; // Địa chỉ của bạn
        const bmhdAddress = 'EQB-D_b7xHWPq3N1a6AikTiEYeLmXap262v1XmgGeekGW5Jh'; // Địa chỉ jetton BMHD

        const connectButton = document.getElementById('connectButton');
        const userInfo = document.getElementById('userInfo');
        const walletAddressElement = document.getElementById('walletAddress');
        const tonBalanceElement = document.getElementById('tonBalance');
        const bmhdBalanceElement = document.getElementById('bmhdBalance');
        const sendTonButton = document.getElementById('sendTonButton');
        const getBmhdButton = document.getElementById('getBmhdButton');
        const tonAmountInput = document.getElementById('tonAmount');

        let userWalletAddress;

        connectButton.addEventListener('click', async () => {
            try {
                const wallets = await tonConnectUi.connect();
                if (wallets && wallets.length > 0) {
                    userWalletAddress = wallets[0].address;
                    walletAddressElement.textContent = userWalletAddress;
                    userInfo.style.display = 'block';
                    connectButton.style.display = 'none';
                    await updateBalances();
                }
            } catch (error) {
                console.error('Connection error:', error);
            }
        });

        sendTonButton.addEventListener('click', async () => {
            if (!userWalletAddress) return;
            const amount = TonWeb.utils.toNano(tonAmountInput.value);
            const transfer = tonweb.methods.transfer({
                secretKey: null,
                toAddress: myAddress,
                amount: amount,
                seqno: 0,
                payload: null,
                sendMode: 3,
            });
            try {
                await tonConnectUi.sendTransaction({
                    validUntil: Date.now() + 10 * 60 * 1000,
                    messages: [
                        {
                            address: myAddress,
                            amount: amount.toString(),
                            payload: await transfer.toBoc(false),
                        },
                    ],
                });
                await updateBalances();
            } catch (error) {
                console.error('Send TON error:', error);
            }
        });

        getBmhdButton.addEventListener('click', async () => {
             if (!userWalletAddress) return;
            // logic để get BMHD
            // cần dùng tới ABI của BMHD token để tương tác đúng với contract.
            // TonWeb có hỗ trợ tương tác với contract, bạn cần tìm hiểu thêm.
        });

        async function updateBalances() {
            if (!userWalletAddress) return;
            const tonBalance = await tonweb.getBalance(userWalletAddress);
            tonBalanceElement.textContent = TonWeb.utils.fromNano(tonBalance);
            // logic để lấy balance BMHD
        }
    </script>
</body>
</html>
