<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tương tác hợp đồng để nhận token BMHD</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
</head>
<body>
    <h2>Tương tác hợp đồng để nhận token BMHD</h2>
    <input type="number" id="tonAmount" placeholder="Nhập số TON" min="0.01" step="0.01">
    <button onclick="interactWithContract()">Nhận token BMHD</button>
    <p id="status"></p>

    <script>
        // Khởi tạo TONConnectUI
        const tonConnectUI = new TONConnectUI.TonConnectUI({
            manifestUrl: 'https://bmasshd.click/tonconnect-manifest.json',  // URL của manifest
            buttonRootId: 'ton-connect'  // Vị trí hiển thị nút kết nối
        });

        // Cấu hình URL trả về sau khi kết nối ví
        tonConnectUI.uiOptions = {
            twaReturnUrl: 'https://t.me/bmassk3_bot/?startapp='  // URL trả về
        };

        // Kết nối ví
        async function connectToWallet() {
            try {
                // Kết nối ví
                const connectedWallet = await tonConnectUI.connectWallet();
                if (connectedWallet) {
                    console.log('Đã kết nối với ví:', connectedWallet);
                    document.getElementById('status').innerText = "Ví đã được kết nối thành công!";
                }
            } catch (error) {
                console.error("Lỗi kết nối ví:", error);
                document.getElementById('status').innerText = "Lỗi kết nối ví: " + error.message;
            }
        }

        // Tương tác với hợp đồng để nhận token
        async function interactWithContract() {
            const amountTON = parseFloat(document.getElementById('tonAmount').value);
            if (isNaN(amountTON) || amountTON <= 0) {
                document.getElementById('status').innerText = "Vui lòng nhập số TON hợp lệ.";
                return;
            }

            try {
                // Kiểm tra nếu ví đã được kết nối
                if (!tonConnectUI.isConnected()) {
                    document.getElementById('status').innerText = "Vui lòng kết nối ví trước!";
                    return;
                }

                // Địa chỉ hợp đồng của bạn (thay đổi theo hợp đồng của bạn)
                const contractAddress = "EQABa48hjKzg09hN_HjxOic7r8T1PleIy1dRd8NvZ3922MP0";  // Địa chỉ hợp đồng

                // Tạo giao dịch gọi hàm mint trong hợp đồng để nhận token
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 60,  // Thời gian hết hạn giao dịch
                    messages: [
                        {
                            address: contractAddress,  // Địa chỉ hợp đồng
                            amount: (amountTON * 1e9).toString(),  // Chuyển đổi TON sang nanotons (1 TON = 1e9 nanotons)
                            data: "mint"  // Dữ liệu tương tác với hợp đồng, gọi hàm mint
                        }
                    ]
                };

                // Gửi giao dịch
                const tx = await tonConnectUI.sendTransaction(transaction);
                console.log(tx);

                // Cập nhật trạng thái giao dịch
                document.getElementById('status').innerText = "Giao dịch gửi thành công! Bạn sẽ nhận được token BMHD.";
            } catch (error) {
                document.getElementById('status').innerText = "Lỗi giao dịch: " + error.message;
            }
        }

        // Kết nối ví khi trang tải
        connectToWallet();
    </script>
</body>
</html>
