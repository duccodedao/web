<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TON Connect + Toncenter</title>
    <script src="https://cdn.jsdelivr.net/npm/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background: #f4f4f4; }
        .container { max-width: 500px; background: white; padding: 20px; margin: 50px auto; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1); border-radius: 10px; }
        h1, h2, h3 { color: #007bff; }
        p { font-size: 16px; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <h1>TON Connect + Toncenter</h1>
        <div id="ton-connect"></div> <!-- Nút kết nối ví -->

        <div id="wallet-info" class="hidden">
            <h2>Địa chỉ Wallet:</h2>
            <p id="wallet-address"></p>
            <h2>Địa chỉ Base64:</h2>
            <p id="wallet-base64"></p>

            <h3>Thông tin tài khoản:</h3>
            <p><strong>Số dư:</strong> <span id="balance">Đang tải...</span></p>
            <p><strong>Code Hash:</strong> <span id="code-hash">Đang tải...</span></p>
            <p><strong>Data Hash:</strong> <span id="data-hash">Đang tải...</span></p>
            <p><strong>Trạng thái:</strong> <span id="account-state">Đang tải...</span></p>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async function () {
            const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({ manifestUrl: "https://ton.org/tonconnect-manifest.json" });
            tonConnectUI.renderConnectorButton("#ton-connect");

            tonConnectUI.onStatusChange(async (wallet) => {
                if (wallet) {
                    const address = wallet.account.address;
                    document.getElementById("wallet-address").textContent = address;
                    document.getElementById("wallet-info").classList.remove("hidden");

                    fetchToncenterData(address);
                }
            });
        });

        async function fetchToncenterData(address) {
            const API_KEY = "7ca49f3a2594045069f2613f51acdcd2c5c303c0c2ec4134137ea31b7afa4b6d"; // API key của bạn
            const url = `https://toncenter.com/api/v2/getExtendedAddressInformation?address=${address}&api_key=${API_KEY}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.ok) {
                    document.getElementById("wallet-base64").textContent = data.result.address || "Không có dữ liệu";
                    document.getElementById("balance").textContent = (data.result.balance / 1e9) + " TON"; // Chuyển từ nanoTON sang TON
                    document.getElementById("code-hash").textContent = data.result.code_hash || "Không có dữ liệu";
                    document.getElementById("data-hash").textContent = data.result.data_hash || "Không có dữ liệu";
                    document.getElementById("account-state").textContent = data.result.state || "Không xác định";
                } else {
                    console.error("Lỗi lấy dữ liệu:", data.error);
                    document.getElementById("balance").textContent = "Lỗi lấy dữ liệu";
                }
            } catch (error) {
                console.error("Lỗi kết nối API:", error);
                document.getElementById("balance").textContent = "Lỗi kết nối API";
            }
        }
    </script>
</body>
</html>
