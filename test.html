<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Nh·∫≠n Token Telegram Mini App</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      text-align: center;
      padding: 20px;
      transition: all 0.3s ease;
    }
    img.avatar {
      width: 100px;
      border-radius: 50%;
      margin: 20px auto;
    }
    .username {
      font-size: 20px;
      font-weight: bold;
    }
    .token {
      margin-top: 20px;
      font-size: 22px;
      font-weight: bold;
      color: green;
    }
    .info-box {
      margin-top: 10px;
      font-size: 14px;
      color: gray;
    }
  </style>
</head>
<body>

  <h2>üéÅ Mini App Nh·∫≠n Token</h2>
  <div id="user-info">
    <p>ƒêang t·∫£i th√¥ng tin...</p>
  </div>
  <div class="token">üéâ B·∫°n s·∫Ω nh·∫≠n: <span id="amount">1000</span> BMC</div>
  <div class="info-box">Ch·ªâ nh·∫≠n ƒë∆∞·ª£c 1 l·∫ßn, vui l√≤ng ki·ªÉm tra k·ªπ!</div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready();            // K√≠ch ho·∫°t WebApp
    tg.expand();           // M·ªü r·ªông giao di·ªán
    const user = tg.initDataUnsafe?.user;

    // X·ª≠ l√Ω hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng
    if (user) {
      document.getElementById("user-info").innerHTML = `
        <img src="${user.photo_url}" class="avatar"><br>
        <div class="username">${user.first_name} ${user.last_name || ''}</div>
        <div>@${user.username || 'Kh√¥ng c√≥ username'}</div>
        <div>ID: ${user.id}</div>
      `;
    } else {
      document.getElementById("user-info").innerHTML = `<p>Kh√¥ng th·ªÉ l·∫•y th√¥ng tin ng∆∞·ªùi d√πng.</p>`;
    }

    // Main Button
    tg.MainButton.setText("‚úÖ Nh·∫≠n Token Ngay");
    tg.MainButton.show();

    tg.MainButton.onClick(() => {
      // Rung ph·∫£n h·ªìi
      tg.HapticFeedback.impactOccurred("medium");

      // G·ª≠i d·ªØ li·ªáu v·ªÅ bot
      const data = {
        action: "reward_token",
        user_id: user?.id,
        name: `${user?.first_name} ${user?.last_name || ''}`,
        username: user?.username,
        amount: 1000,
      };

      tg.sendData(JSON.stringify(data));
    });

    // ƒê·ªïi m√†u theo theme Telegram
    function applyTheme() {
      document.body.style.backgroundColor = tg.themeParams.bg_color || "#ffffff";
      document.body.style.color = tg.themeParams.text_color || "#000000";
    }

    tg.onEvent("themeChanged", applyTheme);
    applyTheme(); // G·ªçi l·∫ßn ƒë·∫ßu

    // Theo d√µi thay ƒë·ªïi k√≠ch th∆∞·ªõc (n·∫øu b·∫°n c·∫ßn ƒëi·ªÅu ch·ªânh responsive)
    tg.onEvent("viewportChanged", () => {
      console.log("Viewport thay ƒë·ªïi:", tg.viewportHeight, tg.viewportStableHeight);
    });
  </script>

</body>
</html>
